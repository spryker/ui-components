- pipeline: 'Deploy'
  on: 'CLICK'
  refs:
      - 'refs/heads/*'
  auto_clear_cache: true
  fail_on_prepare_env_warning: true
  resources: 'LARGE'
  actions:
      - action: 'Checkout'
        type: 'BUILD'
        docker_image_name: 'library/node'
        docker_image_tag: '18.13.0'
        execute_commands:
            - 'echo "//registry.npmjs.org/:_authToken=${NPM_TOKEN}" > ~/.npmrc'
            - 'git remote add -f pub https://${GITHUB_TOKEN}@github.com/${BUDDY_REPO_SLUG}.git'
            - 'git fetch pub $BUDDY_EXECUTION_BRANCH'
            - 'git checkout $BUDDY_EXECUTION_BRANCH'
        shell: 'BASH'
      - action: 'npm run release'
        type: 'BUILD'
        docker_image_name: 'library/node'
        docker_image_tag: '18.13.0'
        execute_commands:
            - 'npm ci'
            - 'npm run build'
            - 'npm run release'
        shell: 'BASH'
        trigger_conditions:
            - trigger_condition: 'VAR_IS'
              trigger_variable_value: 'master'
              trigger_variable_key: 'BUDDY_EXECUTION_BRANCH'
            - trigger_condition: 'SUCCESS_PIPELINE'
              trigger_project_name: 'ui-components'
              trigger_pipeline_name: 'Format check / Lint code / Unit Tests / Build (test-master)'
      - action: 'npm run release from-package'
        type: 'BUILD'
        docker_image_name: 'library/node'
        docker_image_tag: '18.13.0'
        execute_commands:
            - 'npm ci'
            - 'npm run build'
            - 'npm run release from-package'
        shell: 'BASH'
        trigger_conditions:
            - trigger_condition: 'VAR_IS'
              trigger_variable_value: 'republish/master'
              trigger_variable_key: 'BUDDY_EXECUTION_BRANCH'
            - trigger_condition: 'SUCCESS_PIPELINE'
              trigger_project_name: 'ui-components'
              trigger_pipeline_name: 'Format check / Lint code / Unit Tests / Build (test-branch)'
      - action: 'npm run release-next'
        type: 'BUILD'
        docker_image_name: 'library/node'
        docker_image_tag: '18.13.0'
        execute_commands:
            - 'npm ci'
            - 'npm run build'
            - 'npm run release-next'
        shell: 'BASH'
        trigger_conditions:
            - trigger_condition: 'VAR_IS'
              trigger_variable_value: 'next'
              trigger_variable_key: 'BUDDY_EXECUTION_BRANCH'
            - trigger_condition: 'SUCCESS_PIPELINE'
              trigger_project_name: 'ui-components'
              trigger_pipeline_name: 'Format check / Lint code / Unit Tests / Build (test-next)'
      - action: 'npm run release-next from-package'
        type: 'BUILD'
        docker_image_name: 'library/node'
        docker_image_tag: '18.13.0'
        execute_commands:
            - 'npm ci'
            - 'npm run build'
            - 'npm run release-next from-package'
        shell: 'BASH'
        trigger_conditions:
            - trigger_condition: 'VAR_IS'
              trigger_variable_value: 'republish/next'
              trigger_variable_key: 'BUDDY_EXECUTION_BRANCH'
            - trigger_condition: 'SUCCESS_PIPELINE'
              trigger_project_name: 'ui-components'
              trigger_pipeline_name: 'Format check / Lint code / Unit Tests / Build (test-branch)'
      - action: 'npm run release-tag'
        type: 'BUILD'
        docker_image_name: 'library/node'
        docker_image_tag: '18.13.0'
        execute_commands:
            - 'npm ci'
            - 'npm run build'
            - 'npm run release-tag'
        shell: 'BASH'
        trigger_conditions:
            - trigger_condition: 'OR'
              trigger_operands:
                  - trigger_condition: 'VAR_IS'
                    trigger_variable_value: 'alpha'
                    trigger_variable_key: 'BUDDY_EXECUTION_BRANCH'
                  - trigger_condition: 'VAR_IS'
                    trigger_variable_value: 'beta'
                    trigger_variable_key: 'BUDDY_EXECUTION_BRANCH'
                  - trigger_condition: 'VAR_IS'
                    trigger_variable_value: 'rc'
                    trigger_variable_key: 'BUDDY_EXECUTION_BRANCH'
            - trigger_condition: 'SUCCESS_PIPELINE'
              trigger_project_name: 'ui-components'
              trigger_pipeline_name: 'Format check / Lint code / Unit Tests / Build (test-branch)'
      - action: 'npm run release-tag from-package'
        type: 'BUILD'
        docker_image_name: 'library/node'
        docker_image_tag: '18.13.0'
        execute_commands:
            - 'npm ci'
            - 'npm run build'
            - 'npm run release-tag from-package'
        shell: 'BASH'
        trigger_conditions:
            - trigger_condition: 'OR'
              trigger_operands:
                  - trigger_condition: 'VAR_IS'
                    trigger_variable_value: 'republish/beta'
                    trigger_variable_key: 'BUDDY_EXECUTION_BRANCH'
                  - trigger_condition: 'VAR_IS'
                    trigger_variable_value: 'republish/alpha'
                    trigger_variable_key: 'BUDDY_EXECUTION_BRANCH'
                  - trigger_condition: 'VAR_IS'
                    trigger_variable_value: 'republish/rc'
                    trigger_variable_key: 'BUDDY_EXECUTION_BRANCH'
            - trigger_condition: 'SUCCESS_PIPELINE'
              trigger_project_name: 'ui-components'
              trigger_pipeline_name: 'Format check / Lint code / Unit Tests / Build (test-branch)'
