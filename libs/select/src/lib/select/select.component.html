<nz-select
  [(ngModel)]="mappedValue"
  (ngModelChange)="handleValueChange($event)"
  [nzShowSearch]="search"
  [nzShowArrow]="true"
  [nzDisabled]="disabled"
  [nzPlaceHolder]="placeholder"
  [nzMode]="multiple ? 'tags' : 'default'"
  [nzSuffixIcon]="suffixIconTpl"
  [nzNotFoundContent]="noOptionsText"
  [nzOptionHeightPx]="40"
  [nzRemoveIcon]="crossIconTpl"
  [nzAllowClear]="!disableClear"
  [nzClearIcon]="clearIconTpl"
  [nzMaxTagCount]="0"
  [nzMaxTagPlaceholder]="tagPlaceholder"
>
  <nz-option
    *ngIf="showSelectAll"
    [nzValue]="selectAllValue"
    [nzLabel]="selectAllTitle"
  >
  </nz-option>

  <nz-option
    *ngFor="let option of mappedOptions"
    [nzValue]="option.value"
    [nzLabel]="option.label"
    [nzDisabled]="option.isDisabled"
    [nzCustomContent]="true"
  >
    {{ option.label }}

    <ng-container
      *ngTemplateOutlet="
        multiple ? multiSelectOptionIconTpl : singleSelectOptionIconTpl
      "
    >
    </ng-container>
  </nz-option>
</nz-select>

<select
  *ngIf="multiple; else singleSelectTpl"
  class="ant-select-native"
  multiple
  [ngModel]="mappedValue"
  [attr.name]="name"
  [disabled]="disabled"
>
  <option></option>
  <option *ngFor="let option of mappedOptions" [value]="option.value">
    {{ option.label }}
  </option>
</select>

<ng-template #singleSelectTpl>
  <select
    class="ant-select-native"
    [ngModel]="mappedValue"
    [attr.name]="name"
    [disabled]="disabled"
  >
    <option></option>
    <option *ngFor="let option of mappedOptions" [value]="option.value">
      {{ option.label }}
    </option>
  </select>
</ng-template>

<ng-template #suffixIconTpl>
  <spy-icon class="ant-select-arrow__icon" [name]="arrowDownIcon"></spy-icon>
</ng-template>

<ng-template #crossIconTpl>
  <spy-icon
    class="ant-select-selector__choice__remove__icon"
    [name]="removeIcon"
  ></spy-icon>
</ng-template>

<ng-template #singleSelectOptionIconTpl>
  <spy-icon
    class="ant-select-item-option__icon--checked"
    [name]="checkIcon"
  ></spy-icon>
</ng-template>

<ng-template #multiSelectOptionIconTpl>
  <span class="ant-select-item-option-state__multiChecked">
    <spy-icon
      class="ant-select-item-option-state__multiChecked--icon"
      [name]="checkIcon"
    ></spy-icon>
  </span>
  <span class="ant-select-item-option-state__multiUnChecked"></span>
</ng-template>

<ng-template #clearIconTpl>
  <spy-icon
    class="ant-select-selection__clear-icon"
    [name]="removeIcon"
  ></spy-icon>
</ng-template>

<!-- TODO: Localize "selected" text once locale pipe available -->
<ng-template #tagPlaceholder let-selectedList>{{
  'select.selected:number' | spyI18n: { number: selectedList.length } | async
}}</ng-template>
