<ng-container *ngIf="createConfig$ | async as createConfig">
  <input [name]="createConfig.formInputName" type="hidden" />
</ng-container>

<ng-container *ngIf="createConfig$ | async as createConfig">
  <ng-container *spyTableFeatureTpl="tableLocation.beforeTable">
    <!-- styles: { display: 'flex', width: '100%' } -->
    <!-- <div style="flex-grow: 1;"></div> -->
    <ng-container *ngIf="addButton$ | async as addButton">
      <spy-button [size]="buttonSize.Small" (click)="toggleAddMode(true)">
        <spy-icon *ngIf="addButton?.icon" [name]="addButton?.icon"></spy-icon>
        {{ addButton?.title }}
      </spy-button>
    </ng-container>
  </ng-container>
</ng-container>

<ng-container *ngIf="createConfig$ | async as createConfig">
  <ng-container
    *spyTableFeatureTpl="tableLocation.beforeRows; let columns = columns"
  >
    <tr *ngFor="let column of createConfig.initialData?.data; let i = index">
      <td *ngFor="let column of columns; let j = index">
        <ng-container *ngIf="mockColumnData$ | async as mockColumnData">
          <ng-container *ngIf="editColumns$ | async as editColumns">
            <spy-table-column-renderer
              [config]="
                getEditColumn
                  | spyInvoke
                    : column
                    : editColumns
                    : (createConfig.initialData?.errors)[i]
              "
              [data]="mockColumnData"
              [i]="i"
              [j]="j"
              (spy-table-editable)="onAddUpdated($event)"
            ></spy-table-column-renderer> <!-- spy-table-editable Output must update the value of current cell in Sync Input -->
          </ng-container>
        </ng-container>
      </td>
      <td>
        <ng-container *ngIf="cancelButtonCreate$ | async as cancelButton">
          <spy-button
            [size]="buttonSize.Small"
            [disabled]="isAddingInProgress || !addModelValid"
            (click)="cancelAdd()"
          >
            <spy-icon
              *ngIf="cancelButton?.icon"
              [name]="cancelButton?.icon"
            ></spy-icon>
            {{ cancelButton?.title }}
          </spy-button>
        </ng-container>
      </td>
    </tr>
  </ng-container>

  <ng-container
    *spyTableFeatureTpl="
      tableLocation.cell;
      let cellTpl;
      let cellContext = context;
      let config = config;
      let row = row;
      let value = value;
      let i = i;
      let j = j
    "
  >
    <ng-container *ngIf="editColumns$ | async as editColumns">
      <ng-container
        *ngIf="checkIfIdExtists | spyInvoke: config:editColumns"
      ></ng-container> <!-- check it Wrap rendering of the default cell in the container-->
      <div class="table-editable-container">
        <spy-popover
          [open]="isEditingCell | spyInvoke: editingCell:i:j"
          [position]="popoverPosition.Bottom"
          [popoverTrigger]="popoverTrigger.Click"
          (openChange)="toggleEditCell($event, i, j)"
        >
          <span
            trigger
            class="table-editable-wrapper"
            [class.editing]="isEditingCell | spyInvoke: editingCell:i:j"
            (click)="toggleEditCell(true, i, j)"
          >
            <ng-container
              *ngTemplateOutlet="cellTpl; context: cellContext"
            ></ng-container>
            <spy-icon [name]="editIcon"></spy-icon>
          </span>
          <div class="table-editable-content">
            <spy-table-column-renderer
              [config]="getEditColumn | spyInvoke: config:editColumns"
              [data]="row"
              [i]="i"
              [j]="j"
              (spy-table-editable)="onEditUpdated($event, i)"
            ></spy-table-column-renderer>
            <div class="table-editable-actions">
              <ng-container *ngIf="saveButtonUpdate$ | async as saveButton">
                <spy-button
                  [size]="buttonSize.Small"
                  [disabled]="isEditingInProgress || !editingModelValid"
                  (click)="submitEdit(row, i, j)"
                >
                  <spy-icon
                    class="table-editable-action"
                    [name]="saveButton.icon"
                  ></spy-icon>
                  {{ saveButton.title }}
                </spy-button>
              </ng-container>

              <ng-container *ngIf="cancelButtonUpdate$ | async as cancelButton">
                <spy-button
                  [size]="buttonSize.Small"
                  [variant]="buttonVariant.Secondary"
                  [disabled]="isEditingInProgress"
                  (click)="cancelEdit(i, j)"
                >
                  <spy-icon
                    class="table-editable-action"
                    [name]="cancelButton.icon"
                  ></spy-icon>
                  {{ cancelButton.title }}
                </spy-button>
              </ng-container>
            </div>
          </div>
        </spy-popover>
      </div>
    </ng-container>
  </ng-container>
</ng-container>
