<spy-table-features-renderer
  [features]="featuresLocation[featureLocation.top]"
></spy-table-features-renderer>

<div class="ant-table-features" *ngIf="config">
  <div class="ant-table-features-col ant-table-features-col--static">
    <ng-container *ngIf="checkedRowsArr.length"
      >{{ checkedRowsArr.length }} selected /
    </ng-container>
    {{ total$ | async }} results
  </div>

  <div class="ant-table-features-col ant-table-features-col--dynamic">
    <spy-table-features-renderer
      [features]="featuresLocation[featureLocation.beforeTable]"
    ></spy-table-features-renderer>
  </div>
</div>

<nz-table nzFrontPagination="false" [nzLoading]="isLoading$ | async">
  <thead nzSingleSort="true" (nzSortChange)="updateSorting($event)">
    <tr>
      <th *ngIf="config?.selectable" class="ant-table-column-selectable">
        <spy-checkbox
          [(checked)]="allChecked"
          [indeterminate]="isIndeterminate"
          (checkedChange)="toggleCheckedRows()"
        ></spy-checkbox>
      </th>

      <th
        *ngFor="let column of columns$ | async; trackBy: trackByColumns"
        [nzShowSort]="column.sortable"
        [nzSortKey]="column.id"
        [nzWidth]="column.width"
      >
        {{ column.title }}
      </th>

      <th
        *ngIf="
          config?.rowActions?.length ||
          featuresLocation[featureLocation.headerExt]?.length > 0
        "
      >
        <spy-table-features-renderer
          [features]="featuresLocation[featureLocation.headerExt]"
          maxFeatures="1"
        ></spy-table-features-renderer>
      </th>
    </tr>
  </thead>

  <tbody>
    <tr
      *ngFor="let data of tableData$ | async; index as indexOfElement"
      [class.ant-table-row--selected]="checkedRows[indexOfElement]"
    >
      <td *ngIf="config?.selectable" class="ant-table-column-selectable">
        <div class="ant-table-column-inner">
          <spy-checkbox
            [(checked)]="checkedRows[indexOfElement]"
            (checkedChange)="updateCheckedRows()"
          ></spy-checkbox>
        </div>
      </td>

      <td
        *ngFor="
          let column of columns$ | async;
          trackBy: trackByColumns;
          let last = last
        "
        [colSpan]="
          !config?.rowActions?.length &&
          featuresLocation[featureLocation.headerExt]?.length > 0 &&
          last
            ? 2
            : 1
        "
      >
        <div class="ant-table-column-inner">
          <spy-table-column-renderer
            [config]="column"
            [data]="data"
            [template]="templatesObj[column.id]"
          ></spy-table-column-renderer>
        </div>
      </td>

      <td *ngIf="config?.rowActions?.length">
        <div class="ant-table-column-inner ant-table-column-inner--align-right">
          <spy-dropdown
            [items]="actions"
            (actionTriggered)="this.actionTriggerHandler($event, [data])"
            class="ant-table-dropdown"
            ><spy-icon name="action"></spy-icon
          ></spy-dropdown>
        </div>
      </td>
    </tr>
  </tbody>
</nz-table>

<spy-table-features-renderer
  [features]="featuresLocation[featureLocation.afterTable]"
></spy-table-features-renderer>

<spy-pagination
  [pageSizeOptions]="config?.pageSizes || [10, 20, 50]"
  [total]="total$ | async"
  [pageSize]="pageSize$ | async"
  [page]="page$ | async"
  disableClear
  (pageChange)="updatePagination($event)"
  (pageSizeChange)="updatePageSize($event)"
></spy-pagination>

<spy-table-features-renderer
  [features]="featuresLocation[featureLocation.bottom]"
></spy-table-features-renderer>

<span
  style="display: none"
  [spySelectComponents]="featureComponentType"
  (spySelectComponentsFound)="updateFeaturesLocation($event)"
>
  <ng-content select="[spy-table-feature]"></ng-content>
</span>

<spy-table-features-renderer
  [features]="featuresLocation[featureLocation.hidden]"
  style="display: none"
></spy-table-features-renderer>
