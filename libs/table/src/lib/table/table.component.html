<div class="ant-table-features ant-table-features--top">
  <spy-table-features-renderer
    [location]="featureLocation.top"
    [features]="features$ | async"
  ></spy-table-features-renderer>
</div>

<div class="ant-table-features ant-table-features--before-table">
  <spy-table-features-renderer
    [location]="featureLocation.beforeTable"
    [features]="features$ | async"
  ></spy-table-features-renderer>
</div>

<nz-table nzFrontPagination="false" [nzLoading]="isLoading$ | async">
  <thead nzSingleSort="true" (nzSortChange)="updateSorting($event)">
    <tr>
      <ng-template
        [spyTableFeaturesRenderer]="featureLocation.beforeColsHeader"
        [spyTableFeaturesRendererFeatures]="features$ | async"
        let-feature
      >
        <th [ngStyle]="feature.featureStyles$ | async">
          <ng-template [spyTableRenderFeature]="feature"></ng-template>
        </th>
      </ng-template>

      <th
        *ngFor="let column of columns$ | async; trackBy: trackByColumns"
        [nzShowSort]="column.sortable"
        [nzSortKey]="column.id"
        [nzSort]="
          (sortingData$ | async | pluck: 'sortBy') === column.id
            ? (sortingData$ | async | pluck: 'sortDirection')
            : null
        "
        [nzWidth]="column.width"
      >
        {{ column.title }}
      </th>

      <ng-template
        [spyTableFeaturesRenderer]="featureLocation.afterColsHeader"
        [spyTableFeaturesRendererFeatures]="features$ | async"
        let-feature
      >
        <th [ngStyle]="feature.featureStyles$ | async">
          <ng-template [spyTableRenderFeature]="feature"></ng-template>
        </th>
      </ng-template>

      <ng-template
        [spyTableFeaturesRenderer]="featureLocation.headerExt"
        [spyTableFeaturesRendererFeatures]="features$ | async"
        [spyTableFeaturesRendererMaxFeatures]="1"
        let-feature
      >
        <th [ngStyle]="feature.featureStyles$ | async">
          <ng-template [spyTableRenderFeature]="feature"></ng-template>
        </th>
      </ng-template>
    </tr>
  </thead>

  <tbody>
    <ng-container
      *ngFor="
        let data of tableData$ | async;
        trackBy: trackByData;
        index as indexOfElement
      "
    >
      <ng-template
        [spyTableFeaturesRenderer]="featureLocation.beforeRow"
        [spyTableFeaturesRendererFeatures]="features$ | async"
        [spyTableFeaturesRendererContext]="{
          data: data,
          i: indexOfElement,
          columns: columns$ | async
        }"
        let-feature
      >
        <tr
          class="ant-table-row-ext ant-table-row-ext__before ant-table-features ant-table-features--before-row"
          [ngClass]="rowClasses[indexOfElement]"
        >
          <ng-container *spyTableRenderFeature="feature"></ng-container>
        </tr>
      </ng-template>

      <tr [ngClass]="rowClasses[indexOfElement]">
        <ng-template
          [spyTableFeaturesRenderer]="featureLocation.beforeCols"
          [spyTableFeaturesRendererFeatures]="features$ | async"
          [spyTableFeaturesRendererContext]="{ data: data, i: indexOfElement }"
          let-feature
        >
          <td [ngStyle]="feature.featureStyles$ | async">
            <div class="ant-table-column-inner">
              <ng-template [spyTableRenderFeature]="feature"></ng-template>
            </div>
          </td>
        </ng-template>

        <td *ngFor="let column of columns$ | async; trackBy: trackByColumns">
          <div class="ant-table-column-inner">
            <spy-table-column-renderer
              [config]="column"
              [data]="data"
              [template]="templatesObj[column.id]"
              [i]="indexOfElement"
            ></spy-table-column-renderer>
          </div>
        </td>

        <ng-template
          [spyTableFeaturesRenderer]="featureLocation.afterCols"
          [spyTableFeaturesRendererFeatures]="features$ | async"
          [spyTableFeaturesRendererContext]="{ data: data, i: indexOfElement }"
          let-feature
        >
          <td [ngStyle]="feature.featureStyles$ | async">
            <div
              class="ant-table-column-inner ant-table-column-inner--align-right"
            >
              <ng-template [spyTableRenderFeature]="feature"></ng-template>
            </div>
          </td>
        </ng-template>
      </tr>

      <ng-template
        [spyTableFeaturesRenderer]="featureLocation.afterRow"
        [spyTableFeaturesRendererFeatures]="features$ | async"
        [spyTableFeaturesRendererContext]="{
          data: data,
          i: indexOfElement,
          columns: columns$ | async
        }"
        let-feature
      >
        <tr
          class="ant-table-row-ext ant-table-row-ext__after ant-table-features ant-table-features--after-row"
          [ngClass]="rowClasses[indexOfElement]"
        >
          <ng-container *spyTableRenderFeature="feature"></ng-container>
        </tr>
      </ng-template>
    </ng-container>
  </tbody>
</nz-table>

<div class="ant-table-features ant-table-features--after-table">
  <spy-table-features-renderer
    [location]="featureLocation.afterTable"
    [features]="features$ | async"
  ></spy-table-features-renderer>
</div>

<div class="ant-table-features ant-table-features--bottom">
  <spy-table-features-renderer
    [location]="featureLocation.bottom"
    [features]="features$ | async"
  ></spy-table-features-renderer>
</div>

<div
  class="ant-table-features ant-table-features--hidden"
  style="display: none"
>
  <spy-table-features-renderer
    [location]="featureLocation.hidden"
    [features]="features$ | async"
  ></spy-table-features-renderer>
</div>

<span
  style="display: none"
  [spySelectComponents]="featureComponentType"
  (spySelectComponentsFound)="updateFeatures($event)"
>
  <ng-content select="[spy-table-feature]"></ng-content>
</span>

<ng-template #rowExt let-columns>
  <td [attr.colspan]="columns.length">
    <div class="ant-table-column-inner">TEST</div>
  </td>
</ng-template>
