<div class="ant-table-features ant-table-features--top">
  <spy-table-features-renderer
    [location]="featureLocation.top"
    [features]="features$ | async"
  ></spy-table-features-renderer>
</div>

<div class="ant-table-features ant-table-features--before-table">
  <spy-table-features-renderer
    [location]="featureLocation.beforeTable"
    [features]="features$ | async"
  ></spy-table-features-renderer>
</div>

<div class="ant-table-empty" *ngIf="isEmpty$ | async">
  <ng-container *ngIf="isNotFiltered$ | async; else elseEmptyBlock">
    <spy-icon name="no-data" class="ant-table-empty__icon"></spy-icon>
    <!-- TODO: add i18n pipe -->
    <h2 class="ant-table-empty__title">There is nothing here.</h2>
  </ng-container>

  <ng-template #elseEmptyBlock>
    <spy-icon
      name="no-filtered-data"
      class="ant-table-empty__icon ant-table-empty__icon--sm"
    ></spy-icon>
    <!-- TODO: add i18n pipe -->
    <h3 class="ant-table-empty__title ant-table-empty__title--sm">
      No results
    </h3>
    <p>Try changing filter criteria</p>
  </ng-template>
</div>

<ng-container *ngIf="tableData$ | async | pluck: 'length'">
  <nz-table nzFrontPagination="false" [nzLoading]="isLoading$ | async">
    <thead nzSortFn="true" (nzSortOrderChange)="updateSorting($event)">
      <tr>
        <ng-template
          [spyTableFeaturesRenderer]="featureLocation.beforeColsHeader"
          [spyTableFeaturesRendererFeatures]="features$ | async"
          let-feature
        >
          <th [ngStyle]="feature.featureStyles$ | async">
            <ng-template [spyTableRenderFeature]="feature"></ng-template>
          </th>
        </ng-template>

        <th
          *ngFor="let column of columns$ | async; trackBy: trackByColumns"
          [nzShowSort]="column.sortable"
          [nzColumnKey]="column.id"
          [nzSortOrder]="
            (sortingData$ | async | pluck: 'sortBy') === column.id
              ? (sortingData$ | async | pluck: 'sortDirection')
              : null
          "
          [nzWidth]="column.width"
        >
          {{ column.title }}
        </th>

        <ng-template
          [spyTableFeaturesRenderer]="featureLocation.afterColsHeader"
          [spyTableFeaturesRendererFeatures]="features$ | async"
          let-feature
        >
          <th [ngStyle]="feature.featureStyles$ | async">
            <ng-template [spyTableRenderFeature]="feature"></ng-template>
          </th>
        </ng-template>

        <ng-template
          [spyTableFeaturesRenderer]="featureLocation.headerExt"
          [spyTableFeaturesRendererFeatures]="features$ | async"
          [spyTableFeaturesRendererMaxFeatures]="1"
          let-feature
        >
          <th [ngStyle]="feature.featureStyles$ | async">
            <ng-template [spyTableRenderFeature]="feature"></ng-template>
          </th>
        </ng-template>
      </tr>
    </thead>

    <tbody>
      <tr
        *ngFor="
          let data of tableData$ | async;
          trackBy: trackByData;
          index as indexOfElement
        "
        [ngClass]="rowClasses[indexOfElement]"
      >
        <ng-template
          [spyTableFeaturesRenderer]="featureLocation.beforeCols"
          [spyTableFeaturesRendererFeatures]="features$ | async"
          [spyTableFeaturesRendererContext]="{ data: data, i: indexOfElement }"
          let-feature
        >
          <td [ngStyle]="feature.featureStyles$ | async">
            <div class="ant-table-column-inner">
              <ng-template [spyTableRenderFeature]="feature"></ng-template>
            </div>
          </td>
        </ng-template>

        <td *ngFor="let column of columns$ | async; trackBy: trackByColumns">
          <div class="ant-table-column-inner">
            <spy-table-column-renderer
              [config]="column"
              [data]="data"
              [template]="templatesObj[column.id]"
              [i]="indexOfElement"
            ></spy-table-column-renderer>
          </div>
        </td>

        <ng-template
          [spyTableFeaturesRenderer]="featureLocation.afterCols"
          [spyTableFeaturesRendererFeatures]="features$ | async"
          [spyTableFeaturesRendererContext]="{ data: data, i: indexOfElement }"
          let-feature
        >
          <td [ngStyle]="feature.featureStyles$ | async">
            <div class="ant-table-column-inner">
              <ng-template [spyTableRenderFeature]="feature"></ng-template>
            </div>
          </td>
        </ng-template>
      </tr>
    </tbody>
  </nz-table>
</ng-container>

<div class="ant-table-features ant-table-features--after-table">
  <spy-table-features-renderer
    [location]="featureLocation.afterTable"
    [features]="features$ | async"
  ></spy-table-features-renderer>
</div>

<div class="ant-table-features ant-table-features--bottom">
  <spy-table-features-renderer
    [location]="featureLocation.bottom"
    [features]="features$ | async"
  ></spy-table-features-renderer>
</div>

<div
  class="ant-table-features ant-table-features--hidden"
  style="display: none"
>
  <spy-table-features-renderer
    [location]="featureLocation.hidden"
    [features]="features$ | async"
  ></spy-table-features-renderer>
</div>

<span
  style="display: none"
  [spySelectComponents]="featureComponentType"
  (spySelectComponentsFound)="updateFeatures($event)"
>
  <ng-content select="[spy-table-feature]"></ng-content>
</span>
